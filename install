if (Get-Service -Name "ZapretService" -ErrorAction SilentlyContinue) {
    Write-Host "Служба ZapretService найдена. Выполняются команды..."
    Stop-Process -Name "winws" -Force -ErrorAction SilentlyContinue
    Stop-Service -Name "ZapretService" -Force -ErrorAction SilentlyContinue
    Remove-Service -Name "ZapretService" -ErrorAction SilentlyContinue
    Stop-Service -Name "windivert" -Force -ErrorAction SilentlyContinue
    Remove-Service -Name "windivert" -ErrorAction SilentlyContinue
} else {
    Write-Host "Служба ZapretService не найдена."
}

$desktopPath = [System.Environment]::GetFolderPath('Desktop')

$zapretZipPath = "$env:USERPROFILE\Downloads\zapret.zip"
$zapretFolderPath = "$desktopPath\zapret"

$zipUrl = "https://github.com/vayulqq/zapret/releases/download/qedqedndndn/zapret.zip"

if (Test-Path $zapretZipPath) {
    Remove-Item $zapretZipPath -Force
}

if (Test-Path $zapretFolderPath) {
    Remove-Item $zapretFolderPath -Recurse -Force
}

Invoke-WebRequest -Uri $zipUrl -OutFile $zapretZipPath

Expand-Archive -Path $zapretZipPath -DestinationPath $desktopPath -Force

Remove-Item $zapretZipPath -Force

Exit
